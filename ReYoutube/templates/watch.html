{% from "macros.html" import render_comments with context%}
{% extends "layout.html" %}

{% block extra_head %}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <meta name="video_id" content="{{video_id}}">
    <script src="/static/edit.js"></script>
    <link href="/static/watch.css" rel="stylesheet">

{% endblock %}

{% block title%} {{video_id}} {% endblock %}

{% block content %}
<div class="container-sm">
      <div id="video-container" class="ratio ratio-16x9">
            <iframe width="1280" height="720" loading="lazy"
                src="https://www.youtube.com/embed/{{video_id}}"
                title="YouTube video player" frameborder="0"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                allowfullscreen>
            </iframe>
      </div>

    <hr>

      <div class="rounded container-sm">
             <div id="comment_input" class="mt-5">
                 <form class="input-group mb-3" action="{{url_for('watch', page=comments.page)}}" method="POST">
                    <input id="add-comment-input" type="text" class="form-control" name="message" placeholder="Comment message" aria-label="Comment message" aria-describedby="button-addon2">
                     <input type="hidden" name="action" value="add">
                     <input type="hidden" name="video_id" value={{video_id}}>
                     <button class="btn btn-outline-primary" type="submit" id="button-addon2">Send</button>
                 </form>
             </div>
            <div>
                {{num_comments}} Comments
            </div>
            <div id="comments" class="py-3">

                  <!-- cool spinner
                  <div class="d-flex justify-content-center mb-3">
                    <div class="spinner-border" role="status"></div>
                  </div>-->
                {{ render_comments(comments.items, 0, auto_collapse, comments.page) }}

                <nav aria-label="Page navigation" class="my-3">
                      <ul class="pagination d-flex justify-content-center">
                            {% if comments.has_prev %}
                                <li class="page-item">
                                    <a class="page-link"
                                       href="{{url_for('watch', page=comments.prev_num)}}?v={{video_id}}">Previous</a>
                                </li>
                            {% endif %}

                            {% for page_num in comments.iter_pages() %}
                                {% if page_num %}
                                    {% if page_num != comments.page %}
                                        <li class="page-item">
                                            <a class="page-link"
                                               href="{{url_for('watch', page=page_num)}}?v={{video_id}}">{{page_num}}</a>
                                        </li>
                                    {% else %}
                                        <li class="page-item active">
                                            <a class="page-link"
                                               href="{{url_for('watch', page=page_num)}}?v={{video_id}}">{{page_num}}</a>
                                        </li>
                                    {% endif %}
                               {% else %}
                                   <li>
                                       <span class="ellipsis" style="white-space; nowrap; overflow: hidden; text-overflow: ellipsis">â€¦</span>
                                   </li>
                               {% endif %}
                            {% endfor %}


                          {% if comments.has_next %}
                            <li class="page-item">
                                <a class="page-link"
                                   href="{{url_for('watch', page=comments.next_num)}}?v={{video_id}}">Next</a>
                            </li>
                          {% endif %}
                      </ul>

                    {% if comments.items |length %}
                        <p class="text-right mt-3">
                           Showing page {{ comments.page }} of {{ comments.pages }}
                        </p>
                    {% endif %}
                </nav>
            </div>
      </div>

</div>

{% endblock %}
